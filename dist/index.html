<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>GREEBLE</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:fixed;top:50%;bottom:0;left:50%;right:0;width:144vmin;height:96vmin;transform:translate(-50%,-25%);image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var Stats=function(){function t(t){return o.appendChild(t.dom),t}function e(t){for(var e=0;e<o.children.length;e++)o.children[e].style.display=e===t?"block":"none";n=t}var n=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(t){t.preventDefault(),e(++n%o.children.length)},!1);var r=(performance||Date).now(),i=r,s=0,a=t(new Stats.Panel("FPS","#0ff","#002")),u=t(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=t(new Stats.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:o,addPanel:t,showPanel:e,begin:function(){r=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(u.update(t-r,200),t>i+1e3&&(a.update(1e3*s/(t-i),100),i=t,s=0,f)){var e=performance.memory;f.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:o,setMode:e}};Stats.Panel=function(t,e,n){var o=1/0,r=0,i=Math.round,s=i(window.devicePixelRatio||1),a=80*s,u=48*s,f=3*s,c=2*s,l=3*s,d=15*s,h=74*s,p=30*s,v=document.createElement("canvas");v.width=a,v.height=u,v.style.cssText="width:80px;height:48px";var w=v.getContext("2d");return w.font="bold "+9*s+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=n,w.fillRect(0,0,a,u),w.fillStyle=e,w.fillText(t,f,c),w.fillRect(l,d,h,p),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(l,d,h,p),{dom:v,update:function(u,m){o=Math.min(o,u),r=Math.max(r,u),w.fillStyle=n,w.globalAlpha=1,w.fillRect(0,0,a,d),w.fillStyle=e,w.fillText(i(u)+" "+t+" ("+i(o)+"-"+i(r)+")",f,c),w.drawImage(v,l+s,d,h-s,p,l,d,h-s,p),w.fillRect(l+h-s,d,s,p),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(l+h-s,d,s,i((1-u/m)*p))}}},"object"==typeof module&&(module.exports=Stats),function(){function e(t){return Math.cos(6.28318531*t)}function n(t=0){G.fill(t,A,A+g)}function o(t=cursorX,e=cursorY,n=cursorColor,o=cursorColor2){cursorColor2=o,cursorColor=n;let r=(e|=0)%4*4+(t|=0)%4,i=pat&Math.pow(2,r);n|=0,pcolor=i?n:o,0!=pcolor&&(t<0|t>w-1||e<0|e>m-1||(G[A+e*w+t]=i?n:o))}function r(t,e,n,r,i=cursorColor,s=cursorColor2){cursorColor2=s,cursorColor=i;var a,u,f=(r|=0)-(e|=0),c=(n|=0)-(t|=0);if(f<0?(f=-f,u=-1):u=1,c<0?(c=-c,a=-1):a=1,f<<=1,c<<=1,o(t,e,i),c>f)for(var l=f-(c>>1);t!=n;)l>=0&&(e+=u,l-=c),l+=f,o(t+=a,e,i);else for(l=c-(f>>1);e!=r;)l>=0&&(t+=a,l-=f),l+=c,o(t,e+=u,i)}function i(t,e,n=16,o=16,i=cursorColor,s=cursorColor2){cursorColor2=s,cursorColor=i,x1=0|t,y1=0|e,n|=0,o|=0,i|=0;var a=Math.abs(o-y1);if(r(x1,y1,n,y1,i),a>0)for(;--a;)r(x1,y1+a,n,y1+a,i);r(x1,o,n,o,i)}function s(){for(var t=g;t--;)L[t]=M[pal[G[t]]];D.data.set(T),_.putImageData(D,0,0)}function a(e){e[7]||(e[7]=1),e[8]||(e[8]=1);for(var n=e[0].length,r=0;r<n;r++){var s=[];s=f(e[0].charAt(r));for(var a=0;a<5;a++)for(var u=0;u<5;u++)1==s[5*a+u]&&(1==e[4]?o(e[1]+u*e[4]+(5*e[4]+e[3])*r,e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+a*e[4]|0,e[5]):i(e[1]+u*e[4]+(5*e[4]+e[3])*r,e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+a*e[4]|0,e[4],e[4],e[5]))}}function u(t){var e=5*t[7],n=t[0].split("\n"),o=n.slice(0),r=n.length,i=o.sort(function(t,e){return e.length-t.length})[0],s=i.length*e+(i.length-1)*t[3],u=r*e+(r-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var f=t[1],c=t[2],l=t[1]+s,d=t[2]+u;"center"==t[5]?(f=t[1]-s/2,l=t[1]+s/2):"right"==t[5]&&(f=t[1]-s,l=t[1]),"center"==t[6]?(c=t[2]-u/2,d=t[2]+u/2):"bottom"==t[6]&&(c=t[2]-u,d=t[2]);for(var h=f+s/2,p=c+u/2,v=0;v<r;v++){var w=n[v],m=w.length*e+(w.length-1)*t[3],g=t[1],y=t[2]+(e+t[4])*v;"center"==t[5]?g=t[1]-m/2:"right"==t[5]&&(g=t[1]-m),"center"==t[6]?y-=u/2:"bottom"==t[6]&&(y-=u),a([w,g,y,t[3]||0,t[7]||1,t[8],t[9],t[10],t[11]])}return{sx:f,sy:c,cx:h,cy:p,ex:l,ey:d,width:s,height:u}}function f(t){return index=fontString.indexOf(t),fontBitmap.substring(25*index,25*index+25).split("")}function c(t,e,n){this.context=t,this.urlList=e,this.onload=n,this.bufferList=new Array,this.loadCount=0}function l(t=Date.now(),e=1664525,n=1013904223,o=Math.pow(2,32)){this.seed=t,this.a=e,this.c=n,this.m=o}function d(t){return Math.sin(6.283184*t)}function h(t){return.00390625*Math.pow(1.059463094,t-128)}function p(t,e){setTimeout(function(){var n=new Uint8Array(t*k*2),o=n.length-2,r=function(){for(var t=new Date,i=0;o>=0;)if(n[o]=0,n[o+1]=128,o-=2,(i+=1)%1e3==0&&new Date-t>R)return void setTimeout(r,0);setTimeout(function(){e(n)},0)};setTimeout(r,0)},0)}function v(t,e,n,o,r){var i=n.fx_delay_time*o>>1,s=n.fx_delay_amt/255,a=0,u=function(){for(var n=new Date,o=0;a<e-i;){var f=4*a,c=4*(a+i),l=t[c]+(t[c+1]<<8)+(t[f+2]+(t[f+3]<<8)-32768)*s;if(t[c]=255&l,t[c+1]=l>>8&255,l=t[c+2]+(t[c+3]<<8)+(t[f]+(t[f+1]<<8)-32768)*s,t[c+2]=255&l,t[c+3]=l>>8&255,++a,(o+=1)%1e3==0&&new Date-n>R)return void setTimeout(u,0)}setTimeout(r,0)};setTimeout(u,0)}const w=320,m=180,g=w*m,y=0;S=Math.sin,C=Math.cos,B=new AudioContext,audioMaster=B.createGain(),audioMaster.connect(B.destination),viewX=0,viewY=0,cursorX=0,cursorY=0,cursorColor=22,cursorColor2=0,fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0],pat=65535,palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];var x=document.getElementById("canvas"),_=x.getContext("2d"),A=0,M=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610];pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],_.imageSmoothingEnabled=!1,x.width=w,x.height=m;var D=_.getImageData(0,0,w,m),b=new ArrayBuffer(D.data.length),T=new Uint8Array(b),L=new Uint32Array(b),G=new Uint8Array(w*m*10);Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)},Number.prototype.map=function(t,e,n,o){return(this-t)/(e-t)*(o-n)+n},Number.prototype.pad=function(t,e="0"){for(var n=String(this);n.length<(t||2);)n=e+n;return n},c.prototype.loadBuffer=function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer";var o=this;n.onload=function(){o.context.decodeAudioData(n.response,function(n){n?(o.bufferList[e]=n,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):alert("error decoding file data: "+t)},function(t){console.error("decodeAudioData error",t)})},n.onerror=function(){alert("BufferLoader: XHR error")},n.send()},c.prototype.load=function(){for(var t=0;t<this.urlList.length;++t)this.loadBuffer(this.urlList[t],t)},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}},l.prototype.setSeed=function(t){this.seed=t},l.prototype.nextInt=function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},l.prototype.nextFloat=function(){return this.nextInt()/this.m},l.prototype.nextBool=function(t){return null==t&&(t=.5),this.nextFloat()<t},l.prototype.nextFloatRange=function(t,e){return t+this.nextFloat()*(e-t)},l.prototype.nextIntRange=function(t,e){return Math.floor(this.nextFloatRange(t,e))},l.prototype.nextColor=function(){for(var t=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();t.length<6;)t="0"+t;return"#"+t};var E={},k=2,R=33,B=null,P=[d,function(t){return d(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];E.AudioGenerator=function(t){this.mixBuf=t,this.waveSize=t.length/k/2},E.AudioGenerator.prototype.getAudioBuffer=function(t){null===B&&(B=new AudioContext);var e=this.mixBuf,n=this.waveSize*k*2,o=B.createBuffer(k,this.waveSize,44100),r=o.getChannelData(0),i=o.getChannelData(1),s=0,a=function(){for(var u=new Date,f=0;s<n/2;){var c=4*(e[4*s]+(e[4*s+1]<<8)-32768);if(c=c<-32768?-32768:c>32767?32767:c,r[s]=c/32768,c=4*(e[4*s+2]+(e[4*s+3]<<8)-32768),c=c<-32768?-32768:c>32767?32767:c,i[s]=c/32768,s+=1,(f+=1)%1e3==0&&new Date-u>R)return void setTimeout(a,0)}setTimeout(function(){t(o)},0)};setTimeout(a,0)},E.SoundGenerator=function(t,e){this.instr=t,this.rowLen=e||5605,this.osc_lfo=P[t.lfo_waveform],this.osc1=P[t.osc1_waveform],this.osc2=P[t.osc2_waveform],this.attack=t.env_attack,this.sustain=t.env_sustain,this.release=t.env_release,this.panFreq=Math.pow(2,t.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,t.lfo_freq-8)/this.rowLen},E.SoundGenerator.prototype.genSound=function(t,e,n){new Date;for(var o=0,r=0,i=h(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),s=h(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),a=this.instr.fx_resonance/255,u=0,f=0,c=this.attack+this.sustain+this.release-1;c>=0;--c){var l=c+n,p=this.osc_lfo(l*this.lfoFreq)*this.instr.lfo_amt/512+.5,v=1;c<this.attack?v=c/this.attack:c>=this.attack+this.sustain&&(v-=(c-this.attack-this.sustain)/this.release);var w=i;this.instr.lfo_osc1_freq&&(w+=p),this.instr.osc1_xenv&&(w*=v*v),o+=w;var m=this.osc1(o)*this.instr.osc1_vol;w=s,this.instr.osc2_xenv&&(w*=v*v),r+=w,m+=this.osc2(r)*this.instr.osc2_vol,this.instr.noise_fader&&(m+=(2*Math.random()-1)*this.instr.noise_fader*v),m*=v/255;var g=this.instr.fx_freq;this.instr.lfo_fx_freq&&(g*=p);var y=a*(m-f)-(u+=(g=1.5*Math.sin(3.141592*g/44100))*f);switch(f+=g*y,this.instr.fx_filter){case 1:m=y;break;case 2:m=u;break;case 3:m=f;break;case 4:m=u+y}if(w=d(l*this.panFreq)*this.instr.fx_pan_amt/512+.5,m*=39*this.instr.env_master,(l*=4)+3<e.length){var x=e[l]+(e[l+1]<<8)+m*(1-w);e[l]=255&x,e[l+1]=x>>8&255,x=e[l+2]+(e[l+3]<<8)+m*w,e[l+2]=255&x,e[l+3]=x>>8&255}}},E.SoundGenerator.prototype.getAudioGenerator=function(t,e){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,o=this;p(n,function(r){o.genSound(t,r,0),v(r,n,o.instr,o.rowLen,function(){e(new E.AudioGenerator(r))})})},E.SoundGenerator.prototype.createAudioBuffer=function(t,e){this.getAudioGenerator(t,function(t){t.getAudioBuffer(e)})},E.MusicGenerator=function(t){this.song=t,this.waveSize=44100*t.songLen},E.MusicGenerator.prototype.generateTrack=function(t,e,n){var o=this;p(this.waveSize,function(r){var i=o.waveSize,s=o.waveSize*k*2,a=o.song.rowLen,u=o.song.endPattern,f=new E.SoundGenerator(t,a),c=0,l=0,d=0,h=function(){for(var e=new Date;;)if(32!==d){if(l===u-1)return void setTimeout(p,0);var n=t.p[l];if(n){var o=t.c[n-1].n[d];o&&f.genSound(o,r,c)}if(c+=a,d+=1,new Date-e>R)return void setTimeout(h,0)}else d=0,l+=1},p=function(){v(r,i,t,a,m)},w=0,m=function(){for(var t=new Date,o=0;w<s;){var i=e[w]+(e[w+1]<<8)+r[w]+(r[w+1]<<8)-32768;if(e[w]=255&i,e[w+1]=i>>8&255,w+=2,(o+=1)%1e3==0&&new Date-t>R)return void setTimeout(m,0)}setTimeout(n,0)};setTimeout(h,0)})},E.MusicGenerator.prototype.getAudioGenerator=function(t){var e=this;p(this.waveSize,function(n){var o=0,r=function(){o<e.song.songData.length?(o+=1,e.generateTrack(e.song.songData[o-1],n,r)):t(new E.AudioGenerator(n))};r()})},E.MusicGenerator.prototype.createAudioBuffer=function(t){this.getAudioGenerator(function(e){e.getAudioBuffer(t)})},states={},init=(()=>{stats=new Stats,stats.showPanel(1),document.body.appendChild(stats.dom),lcg=new l(1019),sounds={},soundsLoaded=0,totalSounds=8,score=0,last=0,dt=0,now=0,t=0,state="menu",paused=!1,B=new AudioContext,loop()}),window.addEventListener("keyup",function(t){Key.onKeyup(t)},!1),window.addEventListener("keydown",function(t){Key.onKeydown(t)},!1),window.addEventListener("blur",function(t){paused=!0},!1),window.addEventListener("focus",function(t){paused=!1},!1),loop=(e=>{if(stats.begin(),paused)u(["PAUSED",w/2,128,3,1,"center","top",4,21,0]);else{pal=palDefault;let e=(new Date).getTime();dt=Math.min(1,(e-last)/1e3),t+=dt,states[state].step(dt),last=e,states[state].render()}s(),stats.end(),requestAnimationFrame(loop)}),states.gameover={step:function(t){Key.isDown(Key.r)&&(state="menu")},render:function(t){A=0,n(0),u(["GAME OVER",192,80,8,15,"center","top",3,27])}},states.menu={step:function(t){Key.isDown(Key.SPACE)&&(state="game")},render:function(t){u(["GAME",w/2,50,14,20,"center","top",7,2])}},states.game={bx:0,step(n){bx=w/2+60*e(t)},render(t){A=y,n(0),i(bx-20,60,bx+20,140,4,5)}},states.loading={init:function(t){},step:function(t){},render:function(e){A=y,n(0),u(["LOADING...",w/2,128+20*Math.sin(t),3,2,"center","top",3,9])}},window.onload=init()}();
</script></body></html>