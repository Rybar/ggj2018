var Stats=function(){function t(t){return r.appendChild(t.dom),t}function e(t){for(var e=0;e<r.children.length;e++)r.children[e].style.display=e===t?"block":"none";o=t}var o=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(t){t.preventDefault(),e(++o%r.children.length)},!1);var i=(performance||Date).now(),n=i,a=0,s=t(new Stats.Panel("FPS","#0ff","#002")),l=t(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new Stats.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:r,addPanel:t,showPanel:e,begin:function(){i=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-i,200),t>n+1e3&&(s.update(1e3*a/(t-n),100),n=t,a=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){i=this.end()},domElement:r,setMode:e}};Stats.Panel=function(t,e,o){var r=1/0,i=0,n=Math.round,a=n(window.devicePixelRatio||1),s=80*a,l=48*a,u=3*a,f=2*a,d=3*a,c=15*a,p=74*a,h=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*a+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=o,v.fillRect(0,0,s,l),v.fillStyle=e,v.fillText(t,u,f),v.fillRect(d,c,p,h),v.fillStyle=o,v.globalAlpha=.9,v.fillRect(d,c,p,h),{dom:m,update:function(l,y){r=Math.min(r,l),i=Math.max(i,l),v.fillStyle=o,v.globalAlpha=1,v.fillRect(0,0,s,c),v.fillStyle=e,v.fillText(n(l)+" "+t+" ("+n(r)+"-"+n(i)+")",u,f),v.drawImage(m,d+a,c,p-a,h,d,c,p-a,h),v.fillRect(d+p-a,c,a,h),v.fillStyle=o,v.globalAlpha=.9,v.fillRect(d+p-a,c,a,n((1-l/y)*h))}}},"object"==typeof module&&(module.exports=Stats),function(){function e(t=0){F.fill(t,K,K+D)}function o(t=cursorX,e=cursorY,o=cursorColor,r=cursorColor2){cursorColor2=r,cursorColor=o;let i=(e|=0)%4*4+(t|=0)%4,n=pat&Math.pow(2,i);o|=0,pcolor=n?o:r,0!=pcolor&&(t<0|t>M-1||e<0|e>b-1||(F[K+e*M+t]=n?o:r))}function r(t,e,r,i,n=cursorColor,a=cursorColor2){cursorColor2=a,cursorColor=n;var s,l,u=(i|=0)-(e|=0),f=(r|=0)-(t|=0);if(u<0?(u=-u,l=-1):l=1,f<0?(f=-f,s=-1):s=1,u<<=1,f<<=1,o(t,e,n),f>u)for(var d=u-(f>>1);t!=r;)d>=0&&(e+=l,d-=f),d+=u,o(t+=s,e,n);else for(d=f-(u>>1);e!=i;)d>=0&&(t+=s,d-=u),d+=f,o(t,e+=l,n)}function i(t=cursorX,e=cursorY,r=5,i=cursorColor,n=cursorColor2){cursorColor2=n,cursorColor=i,t|=0,e|=0,i|=0;var a=-(r|=0),s=0,l=2-2*r;do{o(t-a,e+s,i),o(t-s,e-a,i),o(t+a,e-s,i),o(t+s,e+a,i),(r=l)<=s&&(l+=2*++s+1),(r>a||l>s)&&(l+=2*++a+1)}while(a<0)}function n(t,e,o=5,i=cursorColor,n=cursorColor2){if(cursorColor2=n,cursorColor=i,t|=0,e|=0,o|=0,i|=0,!(o<0)){t|=0,e|=0,i|=0;var a=-(o|=0),s=0,l=2-2*o;do{r(t-a,e-s,t+a,e-s,i),r(t-a,e+s,t+a,e+s,i),(o=l)<=s&&(l+=2*++s+1),(o>a||l>s)&&(l+=2*++a+1)}while(a<0)}}function a(t,e,o=16,i=16,n=cursorColor,a=cursorColor2){cursorColor2=a,cursorColor=n,x1=0|t,y1=0|e,o|=0,i|=0,n|=0;var s=Math.abs(i-y1);if(r(x1,y1,o,y1,n),s>0)for(;--s;)r(x1,y1+s,o,y1+s,n);r(x1,i,o,i,n)}function s(t,e,o=cursorColor,r=cursorColor2,i=o,n=o){cursorColor2=r,cursorColor=o;for(let a=0;a<=M;a++)for(let s=0;s<=b;s++){let l=a-1+s*M,u=a+1+s*M,f=a+(s+1)*M,d=a+(s-1)*M;F[t+(a+s*M)]&&(F[t+l]||(F[e+l]=o),F[t+u]||(F[e+u]=i),F[t+d]||(F[e+d]=r),F[t+f]||(F[e+f]=n))}}function l(t=0,e=0,o=M,r=b,i=0,n=0,a=!1,s=!1,l=pal){t|=0,e|=0,o|=0,r|=0,i|=0,n|=0;for(var u=0;u<r;u++)for(var f=0;f<o;f++)n+u<b&&i+f<M&&n+u>-1&&i+f>-1&&(a&s?F[j+((e+(r-u))*M+t+(o-f))]>0&&(F[K+((n+u)*M+i+f)]=l[F[j+((e+(r-u-1))*M+t+(o-f-1))]]):s&&!a?F[j+((e+(r-u))*M+t+f)]>0&&(F[K+((n+u)*M+i+f)]=l[F[j+((e+(r-u-1))*M+t+f)]]):a&&!s?F[j+((e+u)*M+t+(o-f-1))]>0&&(F[K+((n+u)*M+i+f)]=l[F[j+((e+u)*M+t+(o-f-1))]]):a||s||F[j+((e+u)*M+t+f)]>0&&(F[K+((n+u)*M+i+f)]=l[F[j+((e+u)*M+t+f)]]))}function u(t,e){let o=document.createElement("canvas");o.width=M,o.height=b;let r=o.getContext("2d");r.drawImage(t,0,0);var i=r.getImageData(0,0,M,b);let n=new Uint32Array(i.data.buffer);for(var a=0;a<n.length;a++)F[e+a]=G.indexOf(n[a])}function f(){for(var t=D;t--;)z[t]=G[pal[F[t]]];R.data.set(Y),P.putImageData(R,0,0)}function d(e){e[7]||(e[7]=1),e[8]||(e[8]=1);for(var r=e[0].length,i=0;i<r;i++){var n=[];n=p(e[0].charAt(i));for(var s=0;s<5;s++)for(var l=0;l<5;l++)if(1==n[5*s+l])if(1==e[4])o(e[1]+l*e[4]+(5*e[4]+e[3])*i,e[2]+(e[6]?Math.sin(1*(t+i*e[8])/e[7])*e[6]:0)+s*e[4]|0,e[5]);else{let o=e[1]+l*e[4]+(5*e[4]+e[3])*i,r=e[2]+(e[6]?Math.sin(1*(t+i*e[8])/e[7])*e[6]:0)+s*e[4]|0;a(o,r,o-1+e[4],r-1+e[4],e[5])}}}function c(t){var e=5*t[7],o=t[0].split("\n"),r=o.slice(0),i=o.length,n=r.sort(function(t,e){return e.length-t.length})[0],a=n.length*e+(n.length-1)*t[3],s=i*e+(i-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var l=t[1],u=t[2],f=t[1]+a,c=t[2]+s;"center"==t[5]?(l=t[1]-a/2,f=t[1]+a/2):"right"==t[5]&&(l=t[1]-a,f=t[1]),"center"==t[6]?(u=t[2]-s/2,c=t[2]+s/2):"bottom"==t[6]&&(u=t[2]-s,c=t[2]);for(var p=l+a/2,h=u+s/2,m=0;m<i;m++){var v=o[m],y=v.length*e+(v.length-1)*t[3],g=t[1],x=t[2]+(e+t[4])*m;"center"==t[5]?g=t[1]-y/2:"right"==t[5]&&(g=t[1]-y),"center"==t[6]?x-=s/2:"bottom"==t[6]&&(x-=s),d([v,g,x,t[3]||0,t[7]||1,t[8],t[9],t[10],t[11]])}return{sx:l,sy:u,cx:p,cy:h,ex:f,ey:c,width:a,height:s}}function p(t){return index=fontString.indexOf(t),fontBitmap.substring(25*index,25*index+25).split("")}function h(t,e,o){this.context=t,this.urlList=e,this.onload=o,this.bufferList=new Array,this.loadCount=0}function m(t,e=1,o=0,r=.5,i=!1){var n=X.createBufferSource(),a=X.createGain(),s=X.createStereoPanner();return n.buffer=t,n.connect(s),s.connect(a),a.connect(audioMaster),n.playbackRate.value=e,n.loop=i,a.gain.value=r,s.pan.value=o,n.start(),{volume:a,sound:n}}function v(t=Date.now(),e=1664525,o=1013904223,r=Math.pow(2,32)){this.seed=t,this.a=e,this.c=o,this.m=r}function y(e){var o=!1;return 0==Math.trunc(t)%Math.trunc(e.division)&&t>=e.next_div&&(e.next_div=Math.trunc(t)+Math.trunc(e.division),o=!0),o}function g(t){return Math.sin(6.283184*t)}function x(t){return.00390625*Math.pow(1.059463094,t-128)}function w(t,e){setTimeout(function(){var o=new Uint8Array(t*O*2),r=o.length-2,i=function(){for(var t=new Date,n=0;r>=0;)if(o[r]=0,o[r+1]=128,r-=2,(n+=1)%1e3==0&&new Date-t>N)return void setTimeout(i,0);setTimeout(function(){e(o)},0)};setTimeout(i,0)},0)}function _(t,e,o,r,i){var n=o.fx_delay_time*r>>1,a=o.fx_delay_amt/255,s=0,l=function(){for(var o=new Date,r=0;s<e-n;){var u=4*s,f=4*(s+n),d=t[f]+(t[f+1]<<8)+(t[u+2]+(t[u+3]<<8)-32768)*a;if(t[f]=255&d,t[f+1]=d>>8&255,d=t[f+2]+(t[f+3]<<8)+(t[u]+(t[u+1]<<8)-32768)*a,t[f+2]=255&d,t[f+3]=d>>8&255,++s,(r+=1)%1e3==0&&new Date-o>N)return void setTimeout(l,0)}setTimeout(i,0)};setTimeout(l,0)}const M=300,b=300,D=M*b,k=0,E=D,T=6*D,A=7*D;S=Math.sin,C=Math.cos,viewX=0,viewY=0,cursorX=0,cursorY=0,cursorColor=22,cursorColor2=0,fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0],pat=65535,palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];var L=document.getElementById("canvas"),P=L.getContext("2d"),K=0,j=D,G=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610];pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],P.imageSmoothingEnabled=!1,L.width=M,L.height=b;var R=P.getImageData(0,0,M,b),I=new ArrayBuffer(R.data.length),Y=new Uint8Array(I),z=new Uint32Array(I),F=new Uint8Array(M*b*10);Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)},Number.prototype.map=function(t,e,o,r){return(this-t)/(e-t)*(r-o)+o},Number.prototype.pad=function(t,e="0"){for(var o=String(this);o.length<(t||2);)o=e+o;return o},h.prototype.loadBuffer=function(t,e){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer";var r=this;o.onload=function(){r.context.decodeAudioData(o.response,function(o){o?(r.bufferList[e]=o,++r.loadCount==r.urlList.length&&r.onload(r.bufferList)):alert("error decoding file data: "+t)},function(t){console.error("decodeAudioData error",t)})},o.onerror=function(){alert("BufferLoader: XHR error")},o.send()},h.prototype.load=function(){for(var t=0;t<this.urlList.length;++t)this.loadBuffer(this.urlList[t],t)},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,SEMICOLON:59,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,i:73,j:74,k:75,l:76,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}},v.prototype.setSeed=function(t){this.seed=t},v.prototype.nextInt=function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},v.prototype.nextFloat=function(){return this.nextInt()/this.m},v.prototype.nextBool=function(t){return null==t&&(t=.5),this.nextFloat()<t},v.prototype.nextFloatRange=function(t,e){return t+this.nextFloat()*(e-t)},v.prototype.nextIntRange=function(t,e){return Math.floor(this.nextFloatRange(t,e))},v.prototype.nextColor=function(){for(var t=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();t.length<6;)t="0"+t;return"#"+t};var B={},O=2,N=33,X=null,q=[g,function(t){return g(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];B.AudioGenerator=function(t){this.mixBuf=t,this.waveSize=t.length/O/2},B.AudioGenerator.prototype.getAudioBuffer=function(t){null===X&&(X=new AudioContext);var e=this.mixBuf,o=this.waveSize*O*2,r=X.createBuffer(O,this.waveSize,44100),i=r.getChannelData(0),n=r.getChannelData(1),a=0,s=function(){for(var l=new Date,u=0;a<o/2;){var f=4*(e[4*a]+(e[4*a+1]<<8)-32768);if(f=f<-32768?-32768:f>32767?32767:f,i[a]=f/32768,f=4*(e[4*a+2]+(e[4*a+3]<<8)-32768),f=f<-32768?-32768:f>32767?32767:f,n[a]=f/32768,a+=1,(u+=1)%1e3==0&&new Date-l>N)return void setTimeout(s,0)}setTimeout(function(){t(r)},0)};setTimeout(s,0)},B.SoundGenerator=function(t,e){this.instr=t,this.rowLen=e||5605,this.osc_lfo=q[t.lfo_waveform],this.osc1=q[t.osc1_waveform],this.osc2=q[t.osc2_waveform],this.attack=t.env_attack,this.sustain=t.env_sustain,this.release=t.env_release,this.panFreq=Math.pow(2,t.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,t.lfo_freq-8)/this.rowLen},B.SoundGenerator.prototype.genSound=function(t,e,o){new Date;for(var r=0,i=0,n=x(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),a=x(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),s=this.instr.fx_resonance/255,l=0,u=0,f=this.attack+this.sustain+this.release-1;f>=0;--f){var d=f+o,c=this.osc_lfo(d*this.lfoFreq)*this.instr.lfo_amt/512+.5,p=1;f<this.attack?p=f/this.attack:f>=this.attack+this.sustain&&(p-=(f-this.attack-this.sustain)/this.release);var h=n;this.instr.lfo_osc1_freq&&(h+=c),this.instr.osc1_xenv&&(h*=p*p),r+=h;var m=this.osc1(r)*this.instr.osc1_vol;h=a,this.instr.osc2_xenv&&(h*=p*p),i+=h,m+=this.osc2(i)*this.instr.osc2_vol,this.instr.noise_fader&&(m+=(2*Math.random()-1)*this.instr.noise_fader*p),m*=p/255;var v=this.instr.fx_freq;this.instr.lfo_fx_freq&&(v*=c);var y=s*(m-u)-(l+=(v=1.5*Math.sin(3.141592*v/44100))*u);switch(u+=v*y,this.instr.fx_filter){case 1:m=y;break;case 2:m=l;break;case 3:m=u;break;case 4:m=l+y}if(h=g(d*this.panFreq)*this.instr.fx_pan_amt/512+.5,m*=39*this.instr.env_master,(d*=4)+3<e.length){var w=e[d]+(e[d+1]<<8)+m*(1-h);e[d]=255&w,e[d+1]=w>>8&255,w=e[d+2]+(e[d+3]<<8)+m*h,e[d+2]=255&w,e[d+3]=w>>8&255}}},B.SoundGenerator.prototype.getAudioGenerator=function(t,e){var o=this.attack+this.sustain+this.release-1+32*this.rowLen,r=this;w(o,function(i){r.genSound(t,i,0),_(i,o,r.instr,r.rowLen,function(){e(new B.AudioGenerator(i))})})},B.SoundGenerator.prototype.createAudioBuffer=function(t,e){this.getAudioGenerator(t,function(t){t.getAudioBuffer(e)})},B.MusicGenerator=function(t){this.song=t,this.waveSize=44100*t.songLen},B.MusicGenerator.prototype.generateTrack=function(t,e,o){var r=this;w(this.waveSize,function(i){var n=r.waveSize,a=r.waveSize*O*2,s=r.song.rowLen,l=r.song.endPattern,u=new B.SoundGenerator(t,s),f=0,d=0,c=0,p=function(){for(var e=new Date;;)if(32!==c){if(d===l-1)return void setTimeout(h,0);var o=t.p[d];if(o){var r=t.c[o-1].n[c];r&&u.genSound(r,i,f)}if(f+=s,c+=1,new Date-e>N)return void setTimeout(p,0)}else c=0,d+=1},h=function(){_(i,n,t,s,v)},m=0,v=function(){for(var t=new Date,r=0;m<a;){var n=e[m]+(e[m+1]<<8)+i[m]+(i[m+1]<<8)-32768;if(e[m]=255&n,e[m+1]=n>>8&255,m+=2,(r+=1)%1e3==0&&new Date-t>N)return void setTimeout(v,0)}setTimeout(o,0)};setTimeout(p,0)})},B.MusicGenerator.prototype.getAudioGenerator=function(t){var e=this;w(this.waveSize,function(o){var r=0,i=function(){r<e.song.songData.length?(r+=1,e.generateTrack(e.song.songData[r-1],o,i)):t(new B.AudioGenerator(o))};i()})},B.MusicGenerator.prototype.createAudioBuffer=function(t){this.getAudioGenerator(function(e){e.getAudioBuffer(t)})},states={},init=(()=>{stats=new Stats,stats.showPanel(1),document.body.appendChild(stats.dom),spritesheet=new Image,spritesheet.src="sprites.png",spritesheet.onload=function(){u(spritesheet,A)},sprites={player0:{x:0,y:0,width:16,height:16,frames:10,animations:{idle:[0],walk:[6,7,8,9],jump:[1,2,3,4,5],land:[5,4,3,2,1,0]}},player1:{x:0,y:52,width:16,height:16,frames:10,animations:{idle:[0],walk:[6,7,8,9],jump:[1,2,3,4,5],land:[5,4,3,2,1,0]}},ground:{x:0,y:16,width:300,height:10},pickup:{x:0,y:26,width:10,height:10,frames:4,animations:{idle:[0,1,2,3]}}},X=new AudioContext,audioMaster=X.createGain(),audioMaster.connect(X.destination),bufferLoader=new h(X,["level.mp3","death.mp3","jump.mp3","land.mp3"],nameAudioBuffers),bufferLoader.load(),lcg=new v(1019),soundsReady=!1,sounds={},score=0,last=0,dt=0,now=0,t=0,coinvalue=1,fill_y=b,filling=!1,time_left=0,duration=180,fillColor=0,prevFillColor=2,five_div={division:300,next_div:0},thirty_div={division:1800,next_div:0},next_duration=180,platformInterval=100,platformSpeed=.6,gameStartTime=void 0,gameDuration=30,gameClock="",gameClockColor=9,playerSpeed=2,gravity=8,drag=.8,jumpVelocity=4,state="loading",players=[{x:M/4,xMin:0,xMax:M/2-17,y:b-60,xvel:0,yvel:0,xSpeed:300,ySpeed:600,drag:.8,gravity:25,maxYvel:250,maxXvel:250,minYvel:-700,minXvel:-250,facingLeft:!1,jumping:!1,jumpCooldown:0,score:0,jumpPressed:!1,status:"TIE",statusColor:4,height:16,coins:0},{x:M/4*3,xMin:M/2,xMax:M-17,y:b-60,xvel:0,yvel:0,xSpeed:300,ySpeed:600,drag:.8,gravity:25,maxYvel:250,maxXvel:180,minYvel:-700,minXvel:-180,facingLeft:!1,jumping:!1,jumpCooldown:0,score:0,jumpPressed:!1,status:"TIE",statusColor:4,height:16,coins:0}],difficulties=[{level:"low",platformMaxSize:M/6,platformMinSize:20,multiplier:.01,spaceMult:8,spaceDiv:M/12},{level:"medium",platformMaxSize:M/8,platformMinSize:15,multiplier:.02,spaceMult:12,spaceDiv:M/8},{level:"high",platformMaxSize:M/10,platformMinSize:10,multiplier:.03,spaceMult:16,spaceDiv:3*M/20}],difficulty=difficulties[2],platforms=[],pickups=[],backgroundOrbs=[],platformColors=[7,13,27],platforms.push({x:10,y:b-30,x2:M/2-10,y2:b-20,color:22,color2:22,canCollide:[!0,!0]});for(let t=2;t>-200;t--){let e=Math.floor(Math.random()*Math.floor(3)),o=Math.floor(Math.random()*Math.floor(3));for(;e==o;)o=Math.floor(Math.random()*Math.floor(3));this.generatePlatforms(t*platformInterval,difficulty,e,o,t-2)}for(let t=-100;t<100;t++)backgroundOrbs.push({x:Math.random()*M/2,y:10*t,r:30*Math.random(),dither:6*Math.random()+7|0,color:29});platforms.forEach(function(t,e,o){let r=t.x,i=t.y-10;pickups.push({x:r,y:i,height:10,width:10,x2:r+10,y2:i+10})}),paused=!1,loop()}),window.addEventListener("keyup",function(t){Key.onKeyup(t)},!1),window.addEventListener("keydown",function(t){Key.onKeydown(t)},!1),window.addEventListener("blur",function(t){muted=!0,audioMaster.gain.value=0,paused=!0},!1),window.addEventListener("focus",function(t){muted=!1,audioMaster.gain.value=1,paused=!1},!1),window.addEventListener("gamepadconnected",function(t){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length)}),loop=(e=>{stats.begin(),gamepads=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],gp0=gamepads[0],gp1=gamepads[1],paused?c(["PAUSED",M/2,128,3,1,"center","top",4,21,0]):(pal=palDefault,t+=1,states[state].step(dt),states[state].render()),f(),stats.end(),requestAnimationFrame(loop)}),generatePlatform=((t,e,o,r,i)=>{var n=i*e.multiplier*-1,a=e.platformMaxSize-n,s=Math.floor(Math.random()*(a-e.platformMinSize))+e.platformMinSize,l=s/2,u=M/2-s/2,f=Math.floor(Math.random()*u-l)+l;return{x:f-s/2,y:t,x2:f+s/2,y2:t+5,color:o,color2:r,canCollide:[!0,!0]}}),generatePlatforms=((t,e,o,r,i)=>{var n=i*e.multiplier*-1,a=e.platformMaxSize-n,s=Math.floor(Math.random()*(a-e.platformMinSize))+e.platformMinSize,l=Math.floor(Math.random()*(a-e.platformMinSize))+e.platformMinSize,u=M/2-s-l,f=u/4,d=u/2,c=Math.floor(Math.random()*d),p=Math.floor(Math.random()*d-f)+f,h={x:c,y:t,x2:c+s,y2:t+5,color:platformColors[o],color2:0,canCollide:[!0,!0]},m={x:c+s+p,y:t,x2:c+s+p+l,y2:t+5,color:platformColors[r],color2:0,canCollide:[!0,!0]};platforms.push(h),platforms.push(m)}),nameAudioBuffers=(t=>{sounds.song=t[0],sounds.death=t[1],sounds.jump=t[2],sounds.land=t[3],soundsReady=!0}),states.gameover={step:function(t){Key.isDown(Key.r)&&init()},render:function(t){K=0,cursorColor2=5,c(["GAME OVER",M/2,80,8,15,"center","top",4,27]),c([players[0].status,M/4,180,8,15,"center","top",2,players[0].statusColor]),c([players[1].status,M/2+M/4,180,8,15,"center","top",2,players[1].statusColor])}},states.menu={step:function(t){Key.isDown(Key.SPACE)&&(state="game")},render:function(t){c(["TITLE",M/2,50,14,20,"center","top",6,21])}},states.game={step(t){y(five_div)&&(time_left=duration,filling=1,prevFillColor=fillColor,6==++fillColor&&(fillColor=3)),1===filling?(fill_y=(duration-time_left)*b/duration,0>=--time_left&&(filling=0,fill_y=b)):duration!=next_duration&&(duration=next_duration),Key.isDown(Key.UP)&&(next_duration=next_duration<=232?next_duration+18:next_duration=250,console.log("duration changed to: "+next_duration)),Key.isDown(Key.DOWN)&&(next_duration=next_duration>=48?next_duration-18:next_duration=30,console.log("duration changed to: "+next_duration)),Key.isDown(Key.f)&&(state="gameover")},render(t){K=k,e(0),pat=dither[8],a(0,0,M,fill_y,fillColor,fillColor),1===filling&&a(0,fill_y+1,M,b,prevFillColor,prevFillColor)}},states.proto={step:function(e){if(platforms.forEach(function(t,e,o){}),this.updatePlayer(),gameStartTime){let e=Math.floor((t-gameStartTime)/100);gameClock=(gameDuration-e).pad(2),gameClock<10&&(gameClockColor=gameClock%2==1?9:4),gameClock}this.updateFill()},render:function(t){viewY=players[0].y-b/2,this.drawThings(0),this.drawPlayer(0),c([players[0].score.pad(3),0,0,3,2,"left","top",3,9]),viewY=players[1].y-b/2,this.drawThings(1),this.drawPlayer(1),c([players[1].score.pad(3),M,0,3,2,"right","top",3,9]),c([gameClock,M/2,0,3,2,"center","top",3,gameClockColor]),"00"===gameClock&&(state="gameover")},drawThings:function(s){K=T,e(0),K=E,e(30),cursorColor2=0,backgroundOrbs.forEach(function(t){t.y-viewY<b+100&&t.y-viewY>-100&&(K=E,pat=dither[t.dither],n(t.x,t.y-viewY,t.r,t.color))}),pat=dither[8],a(0,0,M,fill_y,platformColors[fillColor],0),pat=dither[8],a(0,fill_y,M,fill_y+10,platformColors[prevFillColor],0),pat=dither[4],a(0,fill_y+5,M,fill_y+10,platformColors[prevFillColor],0),pat=dither[2],a(0,fill_y+9,M,fill_y+10,platformColors[prevFillColor],0),pat=dither[8];for(let t=0;t<100;t++){let t=Math.random()*M;o(t,fill_y+10,22,22),i(t,fill_y+10,3*Math.random()|0,platformColors[fillColor],22)}!0===filling&&(pat=dither[8],a(0,fill_y+1,M,b,platformColors[prevFillColor],0)),platforms.forEach(function(t){t.canCollide[s]&&t.y-viewY<b&&t.y-viewY>0&&(K=E,pat=dither[0],a(t.x,t.y-viewY,t.x2,t.y2-viewY,t.color,t.color-1))}),pickups.forEach(function(e){if(e.y-viewY<b&&e.y-viewY>0){K=E,j=A;let o=sprites.pickup;l(o.x+o.width*(t%40/10|0),o.y,o.width,o.height,e.x,e.y-viewY)}}),K=k;let u=0==s?0:M/2,f=0==s?M/2:M;pat=dither[0],a(u,b,f,b,30),j=E,l(0,0,M/2,b,0==s?0:M/2,0),r(M/2,0,M/2,b,22,22)},updatePlayer:function(){var t=players[0],e=players[1];t.score=Math.abs(Math.floor(t.y/platformInterval)-2)+t.coins*coinvalue,e.score=Math.abs(Math.floor(e.y/platformInterval)-2)+e.coins*coinvalue,t.score>e.score?(t.status="WINNER",t.statusColor=13,e.status="LOSER",e.statusColor=4):t.score<e.score?(t.status="LOSER",t.statusColor=4,e.status="WINNER",e.statusColor=13):(t.status="TIE",t.statusColor=4,e.status="TIE",e.statusColor=4),this.init_player(0),this.init_player(1);let o=1/60*t.xvel,r=1/60*t.yvel,i=1/60*e.xvel,n=1/60*e.yvel;if(t.x=(t.x+o).clamp(t.xMin,t.xMax),t.y+=r,e.x=(e.x+i).clamp(e.xMin,e.xMax),e.y+=n,this.collision_detect(0),this.collision_detect(1),Key.isDown(Key.d)&&this.move_right(0),Key.isDown(Key.a)&&this.move_left(0),Key.isDown(Key.w)?this.jump(0):t.jumpPressed=!1,Key.isDown(Key.l)&&this.move_right(1),Key.isDown(Key.j)&&this.move_left(1),Key.isDown(Key.i)?this.jump(1):e.jumpPressed=!1,gp0){Math.abs(gp0.axes[0])>.4&&(gp0.axes[0]<-.4&&this.move_left(0),gp0.axes[0]>.4&&this.move_right(0)),gp0.buttons[11].pressed?this.jump(0):t.jumpPressed=!1,gp0.buttons[3].pressed&&this.move_right(0),gp0.buttons[2].pressed&&this.move_left(0)}if(gp1){Math.abs(gp1.axes[0])>.4&&(gp1.axes[0]<-.4&&this.move_left(1),gp1.axes[0]>.4&&this.move_right(1)),gp1.buttons[11].pressed?this.jump(1):e.jumpPressed=!1,gp1.buttons[3].pressed&&this.move_right(1),gp1.buttons[2].pressed&&this.move_left(1)}},drawPlayer:function(t){let e=players[t];K=k,j=A;let o=0==t?sprites.player0:sprites.player1;l(o.x,o.y,o.width,o.height,e.x,e.y-viewY,!e.facingLeft)},collision_detect:function(t){let e=players[t];if(pickups.forEach(function(t,o,r){var i=e.x<M/2?e.x:e.x-M/2;let n=i<=t.x2&&i>=t.x,a=i+e.width<=t.x2&&i+e.width>=t.x,s=e.y<=t.y2&&e.y>=t.y,l=e.y+e.height<=t.y2&&e.y+e.height>=t.y;(n||a)&&(s||l)&&(e.coins++,r.splice(o,1))}),e.yvel>0){var o=e.x<M/2?e.x:e.x-M/2;platforms.some(function(r){if(r.canCollide[t]&&e.oldY+17<=r.y&&e.y+17>=r.y&&o+16>r.x&&o<r.x2)return e.yvel>e.gravity&&m(sounds.land,1,0,.1,!1),e.yvel=0,e.y=r.y-17,e.jumping=!1,!0})}},move_right:function(t){let e=players[t];e.facingLeft=!1,e.xvel=e.xSpeed,(e.x===players[0].x?e.x:e.x-M/2)>M/2-16&&(e.xvel=0),e.x=e.x.clamp(e.xMin,e.xMax)},move_left:function(t){let e=players[t];e.facingLeft=!0,e.xvel=-e.xSpeed,(e.x===players[0].x?e.x:e.x-M/2)<0&&(e.xvel=0),e.x=e.x.clamp(e.xMin,e.xMax)},jump:function(t){let e=players[t];e.jumpPressed||0!==e.yvel||e.jumping||(e.jumping=!0,e.yvel=-e.ySpeed,m(sounds.jump,1,0,.1,!1)),e.jumpPressed=!0},init_player:function(t){let e=players[t];e.oldX=e.x,e.oldY=e.y,e.xvel*=e.drag,e.yvel+=e.gravity,e.yvel=e.yvel.clamp(e.minYvel,e.maxYvel),e.xvel=e.xvel.clamp(e.minXvel,e.maxXvel)},updateFill:function(){y(five_div)&&(time_left=duration,filling=!0,prevFillColor=fillColor,3==++fillColor&&(fillColor=0)),!0===filling?(fill_y=(duration-time_left)*b/duration,0>=--time_left&&(filling=!1,fill_y=b)):duration!=next_duration&&(duration=next_duration),players.forEach(function(t,e){platforms.forEach(function(o){o.y2-t.y+b/2<=fill_y&&o.color===platformColors[fillColor]||o.y-t.y+b/2>fill_y&&o.color===platformColors[prevFillColor]?o.canCollide[e]=!1:o.canCollide[e]=!0})})}},states.loading={init:function(t){},step:function(e){soundsReady&&Key.isDown(Key.SPACE)&&(m(sounds.song,1,0,.15,!0),state="proto",gameStartTime=t)},render:function(o){K=k,e(0),K=E,e(0),(soundsReady=!0)?(c(["READY",M/2,128+20*Math.sin(t/60),3,2,"center","top",3,9]),c(["HIT SPACE TO PLAY",M/2,160+20*Math.sin(t/60),2,2,"center","top",2,9]),s(E,k,6,9,6,3),K=k,j=E):c(["LOADING...",M/2,128+20*Math.sin(t/60),3,2,"center","top",3,9])}},window.onload=init()}();