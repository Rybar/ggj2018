var Stats=function(){function e(e){return n.appendChild(e.dom),e}function t(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";o=e}var o=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),t(++o%n.children.length)},!1);var r=(performance||Date).now(),i=r,a=0,s=e(new Stats.Panel("FPS","#0ff","#002")),l=e(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new Stats.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){r=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(l.update(e-r,200),e>i+1e3&&(s.update(1e3*a/(e-i),100),i=e,a=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:n,setMode:t}};Stats.Panel=function(e,t,o){var n=1/0,r=0,i=Math.round,a=i(window.devicePixelRatio||1),s=80*a,l=48*a,u=3*a,f=2*a,d=3*a,c=15*a,p=74*a,h=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*a+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=o,v.fillRect(0,0,s,l),v.fillStyle=t,v.fillText(e,u,f),v.fillRect(d,c,p,h),v.fillStyle=o,v.globalAlpha=.9,v.fillRect(d,c,p,h),{dom:m,update:function(l,y){n=Math.min(n,l),r=Math.max(r,l),v.fillStyle=o,v.globalAlpha=1,v.fillRect(0,0,s,c),v.fillStyle=t,v.fillText(i(l)+" "+e+" ("+i(n)+"-"+i(r)+")",u,f),v.drawImage(m,d+a,c,p-a,h,d,c,p-a,h),v.fillRect(d+p-a,c,a,h),v.fillStyle=o,v.globalAlpha=.9,v.fillRect(d+p-a,c,a,i((1-l/y)*h))}}},"object"==typeof module&&(module.exports=Stats),function(){function e(e=0){R.fill(e,L,L+M)}function o(e=cursorX,t=cursorY,o=cursorColor,n=cursorColor2){cursorColor2=n,cursorColor=o;let r=(t|=0)%4*4+(e|=0)%4,i=pat&Math.pow(2,r);o|=0,pcolor=i?o:n,0!=pcolor&&(e<0|e>w-1||t<0|t>_-1||(R[L+t*w+e]=i?o:n))}function n(e,t,n,r,i=cursorColor,a=cursorColor2){cursorColor2=a,cursorColor=i;var s,l,u=(r|=0)-(t|=0),f=(n|=0)-(e|=0);if(u<0?(u=-u,l=-1):l=1,f<0?(f=-f,s=-1):s=1,u<<=1,f<<=1,o(e,t,i),f>u)for(var d=u-(f>>1);e!=n;)d>=0&&(t+=l,d-=f),d+=u,o(e+=s,t,i);else for(d=f-(u>>1);t!=r;)d>=0&&(e+=s,d-=u),d+=f,o(e,t+=l,i)}function r(e,t,o=5,r=cursorColor,i=cursorColor2){if(cursorColor2=i,cursorColor=r,e|=0,t|=0,o|=0,r|=0,!(o<0)){e|=0,t|=0,r|=0;var a=-(o|=0),s=0,l=2-2*o;do{n(e-a,t-s,e+a,t-s,r),n(e-a,t+s,e+a,t+s,r),(o=l)<=s&&(l+=2*++s+1),(o>a||l>s)&&(l+=2*++a+1)}while(a<0)}}function i(e,t,o=16,r=16,i=cursorColor,a=cursorColor2){cursorColor2=a,cursorColor=i,x1=0|e,y1=0|t,o|=0,r|=0,i|=0;var s=Math.abs(r-y1);if(n(x1,y1,o,y1,i),s>0)for(;--s;)n(x1,y1+s,o,y1+s,i);n(x1,r,o,r,i)}function a(e,t,o=cursorColor,n=cursorColor2,r=o,i=o){cursorColor2=n,cursorColor=o;for(let a=0;a<=w;a++)for(let s=0;s<=_;s++){let l=a-1+s*w,u=a+1+s*w,f=a+(s+1)*w,d=a+(s-1)*w;R[e+(a+s*w)]&&(R[e+l]||(R[t+l]=o),R[e+u]||(R[t+u]=r),R[e+d]||(R[t+d]=n),R[e+f]||(R[t+f]=i))}}function s(e=0,t=0,o=w,n=_,r=0,i=0,a=!1,s=!1,l=pal){e|=0,t|=0,o|=0,n|=0,r|=0,i|=0;for(var u=0;u<n;u++)for(var f=0;f<o;f++)i+u<_&&r+f<w&&i+u>-1&&r+f>-1&&(a&s?R[T+((t+(n-u))*w+e+(o-f))]>=0&&(R[L+((i+u)*w+r+f)]=l[R[T+((t+(n-u-1))*w+e+(o-f-1))]]):s&&!a?R[T+((t+(n-u))*w+e+f)]>=0&&(R[L+((i+u)*w+r+f)]=l[R[T+((t+(n-u-1))*w+e+f)]]):a&&!s?R[T+((t+u)*w+e+(o-f-1))]>=0&&(R[L+((i+u)*w+r+f)]=l[R[T+((t+u)*w+e+(o-f-1))]]):a||s||R[T+((t+u)*w+e+f)]>=0&&(R[L+((i+u)*w+r+f)]=l[R[T+((t+u)*w+e+f)]]))}function l(){for(var e=M;e--;)Y[e]=E[pal[R[e]]];K.data.set(j),P.putImageData(K,0,0)}function u(e){e[7]||(e[7]=1),e[8]||(e[8]=1);for(var n=e[0].length,r=0;r<n;r++){var a=[];a=d(e[0].charAt(r));for(var s=0;s<5;s++)for(var l=0;l<5;l++)if(1==a[5*s+l])if(1==e[4])o(e[1]+l*e[4]+(5*e[4]+e[3])*r,e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+s*e[4]|0,e[5]);else{let o=e[1]+l*e[4]+(5*e[4]+e[3])*r,n=e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+s*e[4]|0;i(o,n,o-1+e[4],n-1+e[4],e[5])}}}function f(e){var t=5*e[7],o=e[0].split("\n"),n=o.slice(0),r=o.length,i=n.sort(function(e,t){return t.length-e.length})[0],a=i.length*t+(i.length-1)*e[3],s=r*t+(r-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var l=e[1],f=e[2],d=e[1]+a,c=e[2]+s;"center"==e[5]?(l=e[1]-a/2,d=e[1]+a/2):"right"==e[5]&&(l=e[1]-a,d=e[1]),"center"==e[6]?(f=e[2]-s/2,c=e[2]+s/2):"bottom"==e[6]&&(f=e[2]-s,c=e[2]);for(var p=l+a/2,h=f+s/2,m=0;m<r;m++){var v=o[m],y=v.length*t+(v.length-1)*e[3],g=e[1],x=e[2]+(t+e[4])*m;"center"==e[5]?g=e[1]-y/2:"right"==e[5]&&(g=e[1]-y),"center"==e[6]?x-=s/2:"bottom"==e[6]&&(x-=s),u([v,g,x,e[3]||0,e[7]||1,e[8],e[9],e[10],e[11]])}return{sx:l,sy:f,cx:p,cy:h,ex:d,ey:c,width:a,height:s}}function d(e){return index=fontString.indexOf(e),fontBitmap.substring(25*index,25*index+25).split("")}function c(e,t,o){this.context=e,this.urlList=t,this.onload=o,this.bufferList=new Array,this.loadCount=0}function p(e,t=1,o=0,n=.5,r=!1){var i=z.createBufferSource(),a=z.createGain(),s=z.createStereoPanner();return i.buffer=e,i.connect(s),s.connect(a),a.connect(audioMaster),i.playbackRate.value=t,i.loop=r,a.gain.value=n,s.pan.value=o,i.start(),{volume:a,sound:i}}function h(e=Date.now(),t=1664525,o=1013904223,n=Math.pow(2,32)){this.seed=e,this.a=t,this.c=o,this.m=n}function m(e){var o=!1;return 0==Math.trunc(t)%Math.trunc(e.division)&&t>=e.next_div&&(e.next_div=Math.trunc(t)+Math.trunc(e.division),o=!0),o}function v(e){return Math.sin(6.283184*e)}function y(e){return.00390625*Math.pow(1.059463094,e-128)}function g(e,t){setTimeout(function(){var o=new Uint8Array(e*B*2),n=o.length-2,r=function(){for(var e=new Date,i=0;n>=0;)if(o[n]=0,o[n+1]=128,n-=2,(i+=1)%1e3==0&&new Date-e>I)return void setTimeout(r,0);setTimeout(function(){t(o)},0)};setTimeout(r,0)},0)}function x(e,t,o,n,r){var i=o.fx_delay_time*n>>1,a=o.fx_delay_amt/255,s=0,l=function(){for(var o=new Date,n=0;s<t-i;){var u=4*s,f=4*(s+i),d=e[f]+(e[f+1]<<8)+(e[u+2]+(e[u+3]<<8)-32768)*a;if(e[f]=255&d,e[f+1]=d>>8&255,d=e[f+2]+(e[f+3]<<8)+(e[u]+(e[u+1]<<8)-32768)*a,e[f+2]=255&d,e[f+3]=d>>8&255,++s,(n+=1)%1e3==0&&new Date-o>I)return void setTimeout(l,0)}setTimeout(r,0)};setTimeout(l,0)}const w=300,_=300,M=w*_,D=0,b=M,A=6*M;S=Math.sin,C=Math.cos,viewX=0,viewY=0,cursorX=0,cursorY=0,cursorColor=22,cursorColor2=0,fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0],pat=65535,palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];var k=document.getElementById("canvas"),P=k.getContext("2d"),L=0,T=M,E=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610];pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],P.imageSmoothingEnabled=!1,k.width=w,k.height=_;var K=P.getImageData(0,0,w,_),G=new ArrayBuffer(K.data.length),j=new Uint8Array(G),Y=new Uint32Array(G),R=new Uint8Array(w*_*10);Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},Number.prototype.map=function(e,t,o,n){return(this-e)/(t-e)*(n-o)+o},Number.prototype.pad=function(e,t="0"){for(var o=String(this);o.length<(e||2);)o=t+o;return o},c.prototype.loadBuffer=function(e,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer";var n=this;o.onload=function(){n.context.decodeAudioData(o.response,function(o){o?(n.bufferList[t]=o,++n.loadCount==n.urlList.length&&n.onload(n.bufferList)):alert("error decoding file data: "+e)},function(e){console.error("decodeAudioData error",e)})},o.onerror=function(){alert("BufferLoader: XHR error")},o.send()},c.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,SEMICOLON:59,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,i:73,j:74,k:75,l:76,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},h.prototype.setSeed=function(e){this.seed=e},h.prototype.nextInt=function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},h.prototype.nextFloat=function(){return this.nextInt()/this.m},h.prototype.nextBool=function(e){return null==e&&(e=.5),this.nextFloat()<e},h.prototype.nextFloatRange=function(e,t){return e+this.nextFloat()*(t-e)},h.prototype.nextIntRange=function(e,t){return Math.floor(this.nextFloatRange(e,t))},h.prototype.nextColor=function(){for(var e=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();e.length<6;)e="0"+e;return"#"+e};var F={},B=2,I=33,z=null,O=[v,function(e){return v(e)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];F.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/B/2},F.AudioGenerator.prototype.getAudioBuffer=function(e){null===z&&(z=new AudioContext);var t=this.mixBuf,o=this.waveSize*B*2,n=z.createBuffer(B,this.waveSize,44100),r=n.getChannelData(0),i=n.getChannelData(1),a=0,s=function(){for(var l=new Date,u=0;a<o/2;){var f=4*(t[4*a]+(t[4*a+1]<<8)-32768);if(f=f<-32768?-32768:f>32767?32767:f,r[a]=f/32768,f=4*(t[4*a+2]+(t[4*a+3]<<8)-32768),f=f<-32768?-32768:f>32767?32767:f,i[a]=f/32768,a+=1,(u+=1)%1e3==0&&new Date-l>I)return void setTimeout(s,0)}setTimeout(function(){e(n)},0)};setTimeout(s,0)},F.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=O[e.lfo_waveform],this.osc1=O[e.osc1_waveform],this.osc2=O[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},F.SoundGenerator.prototype.genSound=function(e,t,o){new Date;for(var n=0,r=0,i=y(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),a=y(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),s=this.instr.fx_resonance/255,l=0,u=0,f=this.attack+this.sustain+this.release-1;f>=0;--f){var d=f+o,c=this.osc_lfo(d*this.lfoFreq)*this.instr.lfo_amt/512+.5,p=1;f<this.attack?p=f/this.attack:f>=this.attack+this.sustain&&(p-=(f-this.attack-this.sustain)/this.release);var h=i;this.instr.lfo_osc1_freq&&(h+=c),this.instr.osc1_xenv&&(h*=p*p),n+=h;var m=this.osc1(n)*this.instr.osc1_vol;h=a,this.instr.osc2_xenv&&(h*=p*p),r+=h,m+=this.osc2(r)*this.instr.osc2_vol,this.instr.noise_fader&&(m+=(2*Math.random()-1)*this.instr.noise_fader*p),m*=p/255;var g=this.instr.fx_freq;this.instr.lfo_fx_freq&&(g*=c);var x=s*(m-u)-(l+=(g=1.5*Math.sin(3.141592*g/44100))*u);switch(u+=g*x,this.instr.fx_filter){case 1:m=x;break;case 2:m=l;break;case 3:m=u;break;case 4:m=l+x}if(h=v(d*this.panFreq)*this.instr.fx_pan_amt/512+.5,m*=39*this.instr.env_master,(d*=4)+3<t.length){var w=t[d]+(t[d+1]<<8)+m*(1-h);t[d]=255&w,t[d+1]=w>>8&255,w=t[d+2]+(t[d+3]<<8)+m*h,t[d+2]=255&w,t[d+3]=w>>8&255}}},F.SoundGenerator.prototype.getAudioGenerator=function(e,t){var o=this.attack+this.sustain+this.release-1+32*this.rowLen,n=this;g(o,function(r){n.genSound(e,r,0),x(r,o,n.instr,n.rowLen,function(){t(new F.AudioGenerator(r))})})},F.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},F.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},F.MusicGenerator.prototype.generateTrack=function(e,t,o){var n=this;g(this.waveSize,function(r){var i=n.waveSize,a=n.waveSize*B*2,s=n.song.rowLen,l=n.song.endPattern,u=new F.SoundGenerator(e,s),f=0,d=0,c=0,p=function(){for(var t=new Date;;)if(32!==c){if(d===l-1)return void setTimeout(h,0);var o=e.p[d];if(o){var n=e.c[o-1].n[c];n&&u.genSound(n,r,f)}if(f+=s,c+=1,new Date-t>I)return void setTimeout(p,0)}else c=0,d+=1},h=function(){x(r,i,e,s,v)},m=0,v=function(){for(var e=new Date,n=0;m<a;){var i=t[m]+(t[m+1]<<8)+r[m]+(r[m+1]<<8)-32768;if(t[m]=255&i,t[m+1]=i>>8&255,m+=2,(n+=1)%1e3==0&&new Date-e>I)return void setTimeout(v,0)}setTimeout(o,0)};setTimeout(p,0)})},F.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;g(this.waveSize,function(o){var n=0,r=function(){n<t.song.songData.length?(n+=1,t.generateTrack(t.song.songData[n-1],o,r)):e(new F.AudioGenerator(o))};r()})},F.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})},states={},init=(()=>{stats=new Stats,stats.showPanel(1),document.body.appendChild(stats.dom),spritesheet=new Image,spritesheet.src="sprites.png",z=new AudioContext,audioMaster=z.createGain(),audioMaster.connect(z.destination),bufferLoader=new c(z,["level.mp3","death.mp3","jump.mp3","land.mp3"],nameAudioBuffers),bufferLoader.load(),lcg=new h(1019),soundsReady=!1,sounds={},score=0,last=0,dt=0,now=0,t=0,fill_y=_,filling=!1,time_left=0,duration=180,fillColor=3,prevFillColor=5,five_div={division:5,next_div:0},thirty_div={division:30,next_div:0},next_duration=180,platformInterval=100,platformSpeed=.6,gameDuration=30,gameClock="",gameClockColor=9,playerSpeed=2,gravity=8,drag=.8,jumpVelocity=4,state="loading",players=[{x:w/4,xMin:0,xMax:w/2-17,y:100,xvel:0,yvel:0,xSpeed:700,ySpeed:600,drag:.8,gravity:25,maxYvel:250,maxXvel:250,minYvel:-700,minXvel:-250,facingLeft:!1,jumping:!1,jumpCooldown:0,score:0,jumpPressed:!1},{x:w/4*3,xMin:w/2,xMax:w-17,y:100,xvel:0,yvel:0,xSpeed:700,ySpeed:600,drag:.8,gravity:25,maxYvel:250,maxXvel:250,minYvel:-700,minXvel:-250,facingLeft:!1,jumping:!1,jumpCooldown:0,score:0,jumpPressed:!1}],difficulties=[{level:"low",platformMaxSize:w/6,platformMinSize:20},{level:"medium",platformMaxSize:w/8,platformMinSize:15},{level:"high",platformMaxSize:w/10,platformMinSize:10}],difficulty=difficulties[2],platforms=[],pickups=[],backgroundOrbs=[],platformColors=[3,19,35],platforms.push({x:10,y:_-30,x2:w/2-10,y2:_-20,color:22,color2:22});for(let t=2;t>-200;t--){let n=Math.floor(Math.random()*Math.floor(3)),r=Math.floor(Math.random()*Math.floor(3));for(;n==r;)r=Math.floor(Math.random()*Math.floor(3));var e=generatePlatform(t*platformInterval,difficulty,platformColors[n],0),o=generatePlatform(t*platformInterval,difficulty,platformColors[r],0);platforms.push(e),platforms.push(o)}platforms.push({x:10,y:_-30,x2:w/2-10,y2:_-20,color:22,color2:22});for(let e=-100;e<100;e++)backgroundOrbs.push({x:Math.random()*w/2,y:10*e,r:30*Math.random(),dither:6*Math.random()+7|0,color:29});platforms.forEach(function(e,t,o){let n=e.x,r=e.y-10;pickups.push({x:n,y:r,height:10,width:10})}),paused=!1,loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){muted=!0,audioMaster.gain.value=0,paused=!0},!1),window.addEventListener("focus",function(e){muted=!1,audioMaster.gain.value=1,paused=!1},!1),window.addEventListener("gamepadconnected",function(e){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id,e.gamepad.buttons.length,e.gamepad.axes.length)}),loop=(e=>{stats.begin(),gamepads=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],gp0=gamepads[0],gp1=gamepads[1],paused?(audioMaster,f(["PAUSED",w/2,128,3,1,"center","top",4,21,0])):(pal=palDefault,t+=1,states[state].step(dt),states[state].render()),l(),stats.end(),requestAnimationFrame(loop)}),generatePlatform=((e,t,o,n)=>{var r=Math.floor(Math.random()*(t.platformMaxSize-t.platformMinSize))+t.platformMinSize,i=r/2,a=w/2-r/2,s=Math.floor(Math.random()*a-i)+i;return{x:s-r/2,y:e,x2:s+r/2,y2:e+5,color:o,color2:n}}),nameAudioBuffers=(e=>{sounds.song=e[0],sounds.death=e[1],sounds.jump=e[2],sounds.land=e[3],soundsReady=!0}),states.gameover={step:function(e){Key.isDown(Key.r)&&(state="menu")},render:function(t){L=0,e(0),cursorColor2=5,f(["GAME OVER",192,80,8,15,"center","top",4,27])}},states.menu={step:function(e){Key.isDown(Key.SPACE)&&(state="game")},render:function(e){f(["TITLE",w/2,50,14,20,"center","top",6,21])}},states.game={step(e){m(five_div)&&(time_left=duration,filling=1,prevFillColor=fillColor,6==++fillColor&&(fillColor=3)),1===filling?(fill_y=(duration-time_left)*_/duration,0>=--time_left&&(filling=0,fill_y=_)):duration!=next_duration&&(duration=next_duration),Key.isDown(Key.UP)&&(next_duration=next_duration<=232?next_duration+18:next_duration=250,console.log("duration changed to: "+next_duration)),Key.isDown(Key.DOWN)&&(next_duration=next_duration>=48?next_duration-18:next_duration=30,console.log("duration changed to: "+next_duration)),Key.isDown(Key.f)&&(state="gameover")},render(t){L=D,e(0),pat=dither[8],i(0,0,w,fill_y,fillColor,fillColor),1===filling&&i(0,fill_y+1,w,_,prevFillColor,prevFillColor)}},states.proto={step:function(e){platforms.forEach(function(e,t,o){}),this.updatePlayer(),gameClock=(gameDuration-Math.floor(t/100)).pad(2),gameClock<10&&(gameClockColor=gameClock%2==0?9:4),this.updateFill()},render:function(e){i(0,0,w,fill_y,platformColors[fillColor],platformColors[fillColor]),!0===filling&&i(0,fill_y+1,w,_,platformColors[prevFillColor],platformColors[prevFillColor]),viewY=players[0].y-_/2,this.drawThings(0),this.drawPlayer(0),f([players[0].score.pad(3),0,0,3,2,"left","top",3,9]),viewY=players[1].y-_/2,this.drawThings(1),this.drawPlayer(1),f([players[1].score.pad(3),w,0,3,2,"right","top",3,9]),f([gameClock,w/2,0,3,2,"center","top",3,gameClockColor])},drawThings:function(t){L=A,e(0),L=b,e(30),cursorColor2=0,backgroundOrbs.forEach(function(e){e.y-viewY<_+100&&e.y-viewY>-100&&(L=b,pat=dither[e.dither],r(e.x,e.y-viewY,e.r,e.color))}),platforms.forEach(function(e){e.y-viewY<_&&e.y-viewY>0&&(L=b,pat=dither[0],i(e.x,e.y-viewY,e.x2,e.y2-viewY,e.color,e.color-1))}),pickups.forEach(function(e){e.y-viewY<_&&e.y-viewY>0&&(L=b,i(e.x,e.y-viewY,e.x+e.width,e.y+e.height-viewY,22))}),L=D;let o=0==t?0:w/2,n=0==t?w/2:w;pat=dither[0],i(o,_,n,_,30),s(0,0,w/2,_,0==t?0:w/2,0)},updatePlayer:function(){var e=players[0],t=players[1];e.score=Math.abs(Math.floor(e.y/platformInterval)-2),t.score=Math.abs(Math.floor(t.y/platformInterval)-2),this.init_player(0),this.init_player(1);let o=1/60*e.xvel,n=1/60*e.yvel,r=1/60*t.xvel,i=1/60*t.yvel;if(e.x=(e.x+o).clamp(e.xMin,e.xMax),e.y+=n,t.x=(t.x+r).clamp(t.xMin,t.xMax),t.y+=i,this.collision_detect(0),this.collision_detect(1),Key.isDown(Key.d)&&this.move_right(0),Key.isDown(Key.a)&&this.move_left(0),Key.isDown(Key.w)?this.jump(0):e.jumpPressed=!1,Key.isDown(Key.l)&&this.move_right(1),Key.isDown(Key.j)&&this.move_left(1),Key.isDown(Key.i)?this.jump(1):t.jumpPressed=!1,gp0){Math.abs(gp0.axes[0])>.4&&(gp0.axes[0]<-.4&&this.move_left(0),gp0.axes[0]>.4&&this.move_right(0)),gp0.buttons[11].pressed?this.jump(0):e.jumpPressed=!1}if(gp1){Math.abs(gp1.axes[0])>.4&&(gp1.axes[0]<-.4&&this.move_left(1),gp1.axes[0]>.4&&this.move_right(1)),gp1.buttons[11].pressed?this.jump(1):t.jumpPressed=!1}},drawPlayer:function(e){let t=players[e];L=D,i(t.x,t.y-viewY,t.x+16,t.y+16-viewY,12,12)},collision_detect:function(e){let t=players[e];if(t.yvel>0){var o=t.x<w/2?t.x:t.x-w/2;platforms.some(function(e){if(t.oldY+17<=e.y&&t.y+17>=e.y&&o+16>e.x&&o<e.x2)return t.yvel>t.gravity&&p(sounds.land,1,0,.1,!1),t.yvel=0,t.y=e.y-17,t.jumping=!1,!0})}},move_right:function(e){let t=players[e];t.facingLeft=!1,t.xvel=t.xSpeed,(t.x===players[0].x?t.x:t.x-w/2)>w/2-16&&(t.xvel=0),t.x=t.x.clamp(t.xMin,t.xMax)},move_left:function(e){let t=players[e];t.facingLeft=!0,t.xvel=-t.xSpeed,(t.x===players[0].x?t.x:t.x-w/2)<0&&(t.xvel=0),t.x=t.x.clamp(t.xMin,t.xMax)},jump:function(e){let t=players[e];t.jumpPressed||0!==t.yvel||t.jumping||(t.jumping=!0,t.yvel=-t.ySpeed,p(sounds.jump,1,0,.1,!1)),t.jumpPressed=!0},init_player:function(e){let t=players[e];t.oldX=t.x,t.oldY=t.y,t.xvel*=t.drag,t.yvel+=t.gravity,t.yvel=t.yvel.clamp(t.minYvel,t.maxYvel),t.xvel=t.xvel.clamp(t.minXvel,t.maxXvel)},updateFill:function(){m(five_div)&&(time_left=duration,filling=!0,prevFillColor=fillColor,3==++fillColor&&(fillColor=0)),!0===filling?(fill_y=(duration-time_left)*_/duration,0>=--time_left&&(filling=!1,fill_y=_)):duration!=next_duration&&(duration=next_duration)}},states.loading={init:function(e){},step:function(e){soundsReady&&Key.isDown(Key.SPACE)&&(p(sounds.song,1,0,.15,!0),state="proto")},render:function(o){L=D,e(0),L=b,e(0),(soundsReady=!0)?(f(["READY",w/2,128+20*Math.sin(t/60),3,2,"center","top",3,9]),f(["HIT SPACE TO PLAY",w/2,160+20*Math.sin(t/60),2,2,"center","top",2,9]),a(b,D,6,9,6,3),L=D,T=b):f(["LOADING...",w/2,128+20*Math.sin(t/60),3,2,"center","top",3,9])}},window.onload=init()}();